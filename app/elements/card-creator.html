<dom-module is="card-creator">
	<style>
		paper-material {
			width: 90%;
			margin: auto;
			margin-top: 5%;
			padding: 20px;
			elevation: 2;
			display: block;
		}
		paper-toggle-button {
			float:right;
		}
		iron-form {
			position: relative;
			float: left;
			display: block;
			width: 50%;
		}
		paper-button {
			position: relative;
			display: inline-block;
		}
		custom-card {
			display: inline-block;
			float: right;
			margin: 0px 20px 20px 0px;
			width: 30%;
			height: 30%;
		}
		custom-card ::content paper-card {
			width: 240px;
			height: 240px;
		}
		custom-card ::content paper-card:hover {
			width: 260px;
			height: 260px;
		}

		custom-card.true ::content paper-card {
			background-color: black;
			color: white;
		}
		span {
			display: inline-block;
			width: 100%;
		}
	</style>
	<template>
		<firebase-document
			id="firebase"
			location="https://card-app.firebaseio.com/cards"
			data="{{data}}"></firebase-document>
		<paper-material>
			<span>
				<h1>Submit your own Cards</h1>
				<iron-form id="form">
					<paper-toggle-button id="black" name="black" active="{{black}}"></paper-toggle-button>
					<paper-input auto-validate pattern={{pattern}} error-message={{error}} name="text" type="text" label="Card" value="{{cardText::input}}"></paper-input>
					<!-- <template is="dom-if" if="{{black}}">
						<paper-input class="number" type="number" label="# of Fields" value={{response::input}}></paper-input>
					</template> -->
					<paper-button raised type="submit" on-tap="submitForm">Submit</paper-button>
				</iron-form>
				<custom-card class$="{{black}}"card-text=[[cardText]]>
				</custom-card>
			</span>
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'card-creator',
			properties: {
				cardText: String,
				black: {
					type: Boolean,
					notify: true
				}, pattern: {
					type: String,
					computed: 'getPattern(black)',
					readOnly: true
				}, error: {
					type: String,
					computed: 'getError(black)',
					readOnly: true
				}
			},
			submitForm: function() {
				var type = this.black ? 'black' : 'white',
					firebase = this.$.firebase,
					count = firebase.data[type].count,
					card = this.black ? {
						text: this.cardText,
						response_count: this.cardText.split(/_/).length - 1,
						stats: {
							play_count: 0
						}
					} : {
						text: this.cardText,
						stats: {
							draw_count: 0,
							play_count: 0,
							win_count: 0
						}
					} ;
				firebase.query.child(type).child('count').set(count+1);
				firebase.query.child(type).child('card_'+(count+1)).set(card);
			},
			getPattern: function(black) {
				return black ? '[^_]*_[^_]*' : '^((?!_).)*$';
			},
			getError: function(black) {
				return black ? 'Black Cards must contain a "_"' : 'White Cards must not contain a "_"';
			}
		})
	</script>
</dom-module>